# Redis
REDIS_URL=redis://localhost:6379

# Drizzle (Neon)
DATABASE_URL=postgresql://neondb_owner:npg_OM2fI1wlEDnP@ep-royal-smoke-ad2noa14-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require
# OpenAI / LLM
OPENAI_API_KEY="sk-........."
EMBEDDING_MODEL=text-embedding-3-small
LLM_MODEL=gpt-4o

# Agente
AGENT_ID=ayudas-navarra
DEFAULT_LOCALE=es

# LLM
LLM_TRIM_HISTORY_TURNS=10
LLM_MAX_CHUNKS=4
LLM_MAX_DESC_CHARS=800
LLM_MAX_DOCS_CHARS=600
LLM_MAX_NORM_CHARS=500
LLM_MAX_OTROS_CHARS=500
LLM_MAX_TOKENS=700
LLM_TEMPERATURE=0.2
LLM_DISTILL_ENABLED=0

# Timeouts
CORE_LLM_TIMEOUT_MS=20000
CORE_RETRIEVER_TIMEOUT_MS=12000

# Verbose
CORE_VERBOSE=1

# Web (para CORS)
WEB_ORIGIN=http://localhost:5173

#memoria neon
DISTILL_EVERY_TURNS=2
RETRIEVER_TOP_K=5
UPDATE_SHORT_SUMMARY_EVERY_TURNS=3
MAX_FACTS=15    

#memoria neon - activar auditoría
MEMORY_AUDIT_TO_NEON=0

# Solo controla la tabla message_sources
# 1 = inserta message_sources
# 0 = NO inserta message_sources (pero SÍ guarda chat_messages/meta)
MEMORY_AUDIT_MESSAGE_SOURCES=0


# ON/OFF global
GUARDRAILS_ENABLED=1
GUARD_MODE=block
GUARD_RAG_MIN_DOCS=1
GUARD_MIN_QUERY_TOKENS=2
GUARD_USE_EMBED_GATE=1
GUARD_EMBED_THRESHOLD=0.56
GUARD_REQUIRE_URL_WHITELIST=1


# Intro guiada
# ON/OFF global
INTRO_GUIDE_ENABLED=0
# Qué campos queremos pedir (orden importa)
INTRO_GUIDE_REQUIRED=company_size,sector,objective

# Recordatorio si faltan datos (cada N turnos)
INTRO_GUIDE_MIN_TURNS=3

# Forzar preguntar solo si el mensaje es “in-scope”
# (si está OUT_OF_SCOPE que actúen los guardarraíles primero)
ONBOARDING_ONLY_IN_SCOPE=1
ONBOARDING_MIN_ANSWERS=3
ONBOARDING_MAX_QUESTIONS=3

# --- Crawler/Scraper/Embedder ON/OFF ---
CRAWLER_ENABLED=1
SCRAPER_ENABLED=1
EMBEDDER_ENABLED=1

# --- Planificación automática (cron estilo crontab) ---
# Lunes a las 04:00. Vacío = sin cron.
CRAWLER_CRON=

# --- Límites / Concurrencia ---
CRAWLER_MAX_CONCURRENCY=4
SCRAPER_MAX_CONCURRENCY=4
EMBEDDER_MAX_CONCURRENCY=2

# --- Networking / Respeto del sitio ---
CRAWLER_OBEY_ROBOTS=1
CRAWLER_USER_AGENT=AgentRAG/1.0
CRAWLER_TIMEOUT_MS=15000
CRAWLER_RETRY=2
CRAWLER_BACKOFF_MS=5000

# --- Política de reindexado (normalmente incremental) ---
REINDEX_STRATEGY=incremental   # incremental | full
RAG_INDEX_NAME=ayuda_idx        # (reutiliza el que ya estabas usando)

# --- Persistencia en Redis (puntero actual y versiones) ---
EMBEDDER_REDIS_PREFIX=ayuda
EMBEDDER_KEEP_HISTORY=1         # guarda ayuda:{id}:v{content_version}
EMBEDDER_WRITE_CURRENT_POINTER=1# escribe/actualiza ayuda:{id}

# --- Umbrales scrapper (sanidad de texto) ---
SCRAPER_MIN_TEXT_LEN=400        # ignora textos demasiado cortos
SCRAPER_NORMALIZE_HTML=1        # normaliza espacios/boilerplate

# --- Auditoría (activar si quieres ver cada etapa) ---
CRAWL_AUDIT_ENABLED=1
SCRAPE_AUDIT_ENABLED=1
EMBED_AUDIT_ENABLED=1


CRAWLER_MAX_AGE_MINUTES=0
CRAWLER_DRY_RUN=0
CRAWLER_ACCEPT_LANGUAGE=es-ES,es;q=0.9
