# Redis
REDIS_URL=redis://localhost:6379

# Drizzle (Neon)
DATABASE_URL=postgresql....
OPENAI_API_KEY="sk-...."
EMBEDDING_MODEL=text-embedding-3-small
LLM_MODEL=gpt-4o

# Agente
AGENT_ID=agenteRAG
DEFAULT_LOCALE=es

# LLM
LLM_TRIM_HISTORY_TURNS=12
LLM_MAX_CHUNKS=5
LLM_MAX_DESC_CHARS=1200
LLM_MAX_TOKENS=900
LLM_TEMPERATURE=0.2

# Timeouts
CORE_LLM_TIMEOUT_MS=20000
CORE_RETRIEVER_TIMEOUT_MS=12000

# Verbose
CORE_VERBOSE=1

# Web 
WEB_ORIGIN=http://localhost:5173

#memoria neon
DISTILL_EVERY_TURNS=2
RETRIEVER_TOP_K=5
UPDATE_SHORT_SUMMARY_EVERY_TURNS=3
MAX_FACTS=15    

#memoria neon - activar auditoría
MEMORY_AUDIT_TO_NEON=1

# Solo controla la tabla message_sources
# 1 = inserta message_sources
# 0 = NO inserta message_sources (pero SÍ guarda chat_messages/meta)
MEMORY_AUDIT_MESSAGE_SOURCES=0


# ON/OFF global
GUARDRAILS_ENABLED=0

# Heurísticas
GUARD_RAG_MIN_DOCS=1
GUARD_MIN_QUERY_TOKENS=3
GUARD_OUT_OF_SCOPE_REGEX=(receta|recetas?|cocinar|cocina|bizcocho|pastel|tarta|guiso|ingredientes|hornear|horno|postre|comida|menú|lentejas|sopa)

# Allowlist de dominio (si no coincide y no hay RAG, bloquea)
GUARD_USE_ALLOWLIST=1
GUARD_ALLOWLIST_REGEX=(ayudas?|subvenciones?|convocatorias?|tr[aá]mites?|navarra|bonos|internacionalizaci[oó]n|digitalizaci[oó]n|energ[ií]a|industria|agroalimentaria|empleo|contrataci[oó]n|inversi[oó]n | hola | buenas | buenos dias | buenas tardes | buenas noches | qué tal | que tal | hello | hi | en que me ayudas)

# Post-procesado de URLs (solo permitir las mostradas)
GUARD_REQUIRE_URL_WHITELIST=1


# Intro guiada
# ON/OFF global
INTRO_GUIDE_ENABLED=1

# Qué campos queremos pedir (orden importa)
INTRO_GUIDE_REQUIRED=company_size,sector,objective

# Recordatorio si faltan datos (cada N turnos)
INTRO_GUIDE_MIN_TURNS=2

# Forzar preguntar solo si el mensaje es “in-scope”
# (si está OUT_OF_SCOPE que actúen los guardarraíles primero)
ONBOARDING_ONLY_IN_SCOPE=1

# --- Crawler/Scraper/Embedder ON/OFF ---
CRAWLER_ENABLED=1
SCRAPER_ENABLED=1
EMBEDDER_ENABLED=1

# --- Planificación automática (cron estilo crontab) ---
CRAWLER_CRON=0 4 * * 1       # Lunes a las 04:00. Vacío = sin cron.

# --- Límites / Concurrencia ---
CRAWLER_MAX_CONCURRENCY=4
SCRAPER_MAX_CONCURRENCY=4
EMBEDDER_MAX_CONCURRENCY=2

# --- Networking / Respeto del sitio ---
CRAWLER_OBEY_ROBOTS=1
CRAWLER_USER_AGENT=AgentRAG/1.0
CRAWLER_TIMEOUT_MS=15000
CRAWLER_RETRY=2
CRAWLER_BACKOFF_MS=5000

# --- Política de reindexado (normalmente incremental) ---
REINDEX_STRATEGY=incremental   # incremental | full
RAG_INDEX_NAME=ayuda_idx        # (reutiliza el que ya estabas usando)

# --- Persistencia en Redis (puntero actual y versiones) ---
EMBEDDER_REDIS_PREFIX=ayuda
EMBEDDER_KEEP_HISTORY=1         # guarda ayuda:{id}:v{content_version}
EMBEDDER_WRITE_CURRENT_POINTER=1# escribe/actualiza ayuda:{id}

# --- Umbrales scrapper (sanidad de texto) ---
SCRAPER_MIN_TEXT_LEN=400        # ignora textos demasiado cortos
SCRAPER_NORMALIZE_HTML=1        # normaliza espacios/boilerplate

# --- Auditoría (activar si quieres ver cada etapa) ---
CRAWL_AUDIT_ENABLED=1
SCRAPE_AUDIT_ENABLED=1
EMBED_AUDIT_ENABLED=1
